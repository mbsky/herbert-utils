
//手动配置导出文件路径
var exportSWFPath = "file:///D|/TOMCAT4/webapps/flashdir/program/skin/ico.swf";
var fileInfos = [
	#foreach($entry in $list)
	["icon_$!{entry.id}", "file:///D|/TOMCAT/webapps/ROOT/$!{entry.name}"],
    #end
];


//配置参数
var width = 1;
var height = 1;
var frameRate = 24;
var compressionType = "photo";//压缩方式(photo:照片，lossless：无损)
var imgQuality = 80;//生成质量（范围：1-100,只在compressionType=photo的情形下可用）

//定义变量
var fileInfo, className, filePath, fileName;
var dom, lib, tl;
var bitmapItem;

//创建新文档
fl.createDocument();
dom = fl.getDocumentDOM();
dom.setPlayerVersion("9");
dom.asVersion=3;
dom.frameRate = frameRate;
dom.width = width;
dom.height = height;
lib=dom.library;
tl=dom.getTimeline();
//在第一帧加入一句安全策略脚本
tl.layers[0].frames[0].actionScript = 'import flash.system.Security;try{Security.allowDomain("*");}catch(e:Error){}';


//添加进库
if(fileInfos.length>0)
{
	//生成动画并发布
	for each(fileInfo in fileInfos)
	{
		className = fileInfo[0];
		filePath = fileInfo[1];
		fileName = filePath.replace(/^(.*\/)*([^\/]+\..+)$/,"$2");
		//如果指定文件存在
		if (FLfile.exists(filePath)) 
		{
			//添加进库，但不舞台上创建实例
			dom.importFile(filePath,true);	

			//设置属性
			lib.selectItem(fileName); 
			lib.renameItem(className+filePath.replace(/^(.*\/)*[^\/]+(\..+)$/,"$2"));
			bitmapItem = lib.getSelectedItems()[0];
			bitmapItem.allowSmoothing = true; //允许平滑

			if(compressionType=="lossless")
			{
				bitmapItem.compressionType = "lossless";
			}
			else
			{
				bitmapItem.compressionType = "photo";
				bitmapItem.quality = imgQuality;
			}

			bitmapItem.linkageExportForAS = true;
			bitmapItem.linkageExportInFirstFrame = true;
			bitmapItem.linkageIdentifier = className;
			bitmapItem.linkageBaseClass = "flash.display.BitmapData";
		}
	}
}

//发布
dom.exportSWF(exportSWFPath, true);
//关闭该文档
fl.closeDocument(dom, false);


//关闭所有打开的文件
fl.closeAll(false);
//退出flash
fl.quit(false);
